# =====================================================================
# RootGuard Unbound Engine
# ---------------------------------------------------------------------
# Base: Official Debian Unbound package
# Runtime: Container optimized
#
# Design Principles:
#   • Full recursive resolver (no forwarding)
#   • DNSSEC validation enabled
#   • No systemd / journald dependency
#   • Foreground execution (Docker-compatible via -d flag)
#   • No PID file handling
#   • Localhost-only binding (engine mode)
#
# This configuration represents the static base layer.
# RootGuard may later generate and validate dynamic variants.
# =====================================================================


server:

  # -------------------------------------------------------------------
  # Container Runtime Behaviour
  # -------------------------------------------------------------------

  # Disable syslog usage.
  # Debian Unbound is compiled with systemd/syslog support.
  # Containers do not provide journald.
  use-syslog: no

  # Disable file-based logging.
  # Docker captures stdout/stderr directly.
  logfile: ""

  # Disable PID file creation.
  # PID files are unnecessary in container runtime.
  pidfile: ""


  # -------------------------------------------------------------------
  # Network Binding
  # -------------------------------------------------------------------

  # Bind only to loopback interface.
  # External exposure must be handled by orchestrator
  # (e.g. network namespace sharing with AdGuard).
  interface: 127.0.0.1

  # Internal resolver port used by RootGuard.
  port: 5335


  # -------------------------------------------------------------------
  # Privacy & Hardening
  # -------------------------------------------------------------------

  # Hide hostname from CHAOS queries.
  hide-identity: yes

  # Hide Unbound version.
  hide-version: yes

  # Enable QNAME minimisation (RFC 7816).
  # Reduces query metadata leakage.
  qname-minimisation: yes

  # Refuse ANY queries to mitigate amplification abuse.
  deny-any: yes


  # -------------------------------------------------------------------
  # DNSSEC Validation
  # -------------------------------------------------------------------

  # Debian provides the root trust anchor via dns-root-data.
  # Location:
  #   /usr/share/dns/root.key
  #
  # Unbound performs automatic RFC5011 updates.
  auto-trust-anchor-file: "/var/lib/unbound/root.key"


  # -------------------------------------------------------------------
  # Access Control
  # -------------------------------------------------------------------

  # Allow only localhost queries.
  # Prevents accidental external resolver exposure.
  access-control: 127.0.0.1/32 allow


  # -------------------------------------------------------------------
  # Performance & Cache Configuration
  # -------------------------------------------------------------------

  # Single-threaded baseline (safe container default).
  num-threads: 1

  # Message cache size.
  msg-cache-size: 32m

  # RRset cache size.
  rrset-cache-size: 64m

  # Prefetch frequently requested records before expiry.
  # Improves latency under moderate load.
  prefetch: yes


  # -------------------------------------------------------------------
  # Logging Level
  # -------------------------------------------------------------------

  # 0 = silent
  # 1 = operational (recommended production level)
  # 2+ = debug
  verbosity: 1

