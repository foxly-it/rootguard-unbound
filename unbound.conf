# =========================================================
# RootGuard Unbound â€“ Recursive DNSSEC Engine
# ---------------------------------------------------------
# Based on official Debian unbound package
# Uses Debian managed trust anchor (/usr/share/dns/root.key)
#
# Design Philosophy:
# - The container is the ENGINE.
# - Exposure is controlled by the orchestrator (Docker/Compose).
# - No external forwarding.
# - Full recursive resolution.
# - DNSSEC validation enabled.
# =========================================================


server:

  # -------------------------------------------------------
  # Network Layer
  # -------------------------------------------------------

  # Listen only on localhost.
  # This prevents accidental external exposure.
  # In production, AdGuard or RootGuard shares the namespace.
  interface: 127.0.0.1

  # Internal resolver port used by RootGuard
  port: 5335


  # -------------------------------------------------------
  # Privacy & Hardening
  # -------------------------------------------------------

  # Do not reveal hostname in CHAOS queries
  hide-identity: yes

  # Do not reveal Unbound version
  hide-version: yes

  # Enable QNAME minimisation (RFC 7816)
  # Reduces query leakage to upstream authoritative servers.
  qname-minimisation: yes

  # Refuse ANY queries (common amplification vector)
  deny-any: yes


  # -------------------------------------------------------
  # DNSSEC Validation
  # -------------------------------------------------------

  # Debian ships and maintains the root trust anchor at:
  #   /usr/share/dns/root.key
  #
  # Unbound automatically updates this via RFC5011.
  # No manual root.key handling required.
  auto-trust-anchor-file: "/usr/share/dns/root.key"


  # -------------------------------------------------------
  # Recursive Resolution
  # -------------------------------------------------------

  # Debian package already provides root hints.
  # Therefore, no explicit root-hints directive is required.
  #
  # Unbound performs full recursive resolution against
  # the global DNS root hierarchy.


  # -------------------------------------------------------
  # Access Control
  # -------------------------------------------------------

  # Allow only localhost queries.
  # This ensures the engine cannot be abused directly.
  # The orchestrator controls namespace-level access.
  access-control: 127.0.0.1/32 allow


  # -------------------------------------------------------
  # Performance Tuning (Safe Defaults)
  # -------------------------------------------------------

  # Use available CPU cores automatically
  num-threads: 1

  # Cache sizes (moderate defaults for container use)
  msg-cache-size: 32m
  rrset-cache-size: 64m

  # Prefetch popular records before they expire
  prefetch: yes

  # Minimal logging (0=quiet, 1=basic, 2+=debug)
  verbosity: 1