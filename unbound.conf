# =========================================================
# RootGuard Unbound â€“ Recursive DNSSEC Engine
# ---------------------------------------------------------
# Debian-based Unbound configuration
#
# Design goals:
#  - Full recursive resolver (no forwarding)
#  - DNSSEC validation enabled
#  - Container-optimized runtime
#  - No systemd/syslog dependency
#  - Internal engine (localhost only)
#
# This configuration is intended to be controlled
# and rendered dynamically by the RootGuard dashboard.
# =========================================================


server:

  # -------------------------------------------------------
  # Logging Behaviour (Container Optimized)
  # -------------------------------------------------------

  # Debian's Unbound is compiled with systemd/syslog support.
  # Containers typically do not run systemd.
  # Therefore we explicitly disable syslog usage.
  #
  # Logging stays in foreground (stdout/stderr),
  # allowing Docker to capture logs properly.
  use-syslog: no


  # -------------------------------------------------------
  # Network Interface
  # -------------------------------------------------------

  # Bind only to localhost.
  # The container is designed as an internal DNS engine.
  # Exposure is handled via namespace sharing (e.g. AdGuard).
  interface: 127.0.0.1

  # Internal resolver port used by RootGuard
  port: 5335


  # -------------------------------------------------------
  # Privacy & Hardening
  # -------------------------------------------------------

  # Do not reveal hostname in CHAOS queries
  hide-identity: yes

  # Do not reveal Unbound version
  hide-version: yes

  # Enable QNAME minimisation (RFC 7816)
  # Reduces metadata leakage to authoritative servers.
  qname-minimisation: yes

  # Deny ANY queries (mitigates amplification abuse)
  deny-any: yes


  # -------------------------------------------------------
  # DNSSEC Validation
  # -------------------------------------------------------

  # Debian provides and maintains the root trust anchor
  # via the dns-root-data package.
  #
  # The file is updated automatically using RFC5011.
  # No manual root.key handling required.
  auto-trust-anchor-file: "/usr/share/dns/root.key"


  # -------------------------------------------------------
  # Access Control
  # -------------------------------------------------------

  # Allow only local queries.
  # Prevents external abuse if network isolation fails.
  access-control: 127.0.0.1/32 allow


  # -------------------------------------------------------
  # Performance & Cache
  # -------------------------------------------------------

  # Thread count (container default)
  num-threads: 1

  # Message cache size
  msg-cache-size: 32m

  # RRset cache size
  rrset-cache-size: 64m

  # Prefetch frequently requested records
  # Improves latency for popular domains.
  prefetch: yes


  # -------------------------------------------------------
  # Logging Level
  # -------------------------------------------------------

  # 0 = silent
  # 1 = basic operational info
  # 2+ = debug
  verbosity: 1