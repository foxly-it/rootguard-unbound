# =========================================================
# RootGuard Unbound â€“ Enterprise Recursive DNS Engine
# ---------------------------------------------------------
# Base: Debian official unbound package
#
# Runtime Model:
#  - PID 1 runs as root (container entrypoint)
#  - Unbound drops privileges to user "unbound"
#  - State directory: /var/lib/unbound
#  - Trust anchor prepared during Init phase
#
# Security Goals:
#  - Full recursive resolver (no forwarding)
#  - DNSSEC validation enabled
#  - Minimal attack surface
#  - Container-first logging (stdout)
# =========================================================


server:

  # -------------------------------------------------------
  # Container Runtime Behaviour
  # -------------------------------------------------------

  # Run in foreground (Docker requires this)
  do-daemonize: no

  # Disable syslog (Docker captures stdout/stderr)
  use-syslog: no


  # -------------------------------------------------------
  # Privilege Model
  # -------------------------------------------------------

  # After startup, drop privileges to Debian system user
  username: "unbound"

  # Working directory (must be writable volume)
  directory: "/var/lib/unbound"


  # -------------------------------------------------------
  # Network Binding
  # -------------------------------------------------------

  # Bind only to localhost.
  # Exposure is handled via container networking
  # (e.g. shared namespace with AdGuard).
  interface: 127.0.0.1

  # Internal RootGuard resolver port
  port: 5335


  # -------------------------------------------------------
  # Access Control
  # -------------------------------------------------------

  # Only allow local queries.
  # Prevents external abuse even if network isolation fails.
  access-control: 127.0.0.1/32 allow


  # -------------------------------------------------------
  # DNSSEC Validation
  # -------------------------------------------------------

  # Trust anchor prepared during Init phase.
  # Debian provides a maintained root.key via dns-root-data.
  auto-trust-anchor-file: "/var/lib/unbound/root.key"


  # -------------------------------------------------------
  # Privacy Hardening
  # -------------------------------------------------------

  # Hide hostname in CHAOS queries
  hide-identity: yes

  # Hide version number
  hide-version: yes

  # Reduce metadata leakage to authoritative servers
  qname-minimisation: yes

  # Prevent ANY amplification abuse
  deny-any: yes


  # -------------------------------------------------------
  # Performance & Cache Tuning
  # -------------------------------------------------------

  # Single-threaded (sufficient for container engine role)
  num-threads: 1

  # Message cache size
  msg-cache-size: 32m

  # RRset cache size
  rrset-cache-size: 64m

  # Prefetch popular records before expiration
  prefetch: yes


  # -------------------------------------------------------
  # Logging Level
  # -------------------------------------------------------

  # 0 = silent
  # 1 = operational info
  # 2+ = debug
  verbosity: 1

  