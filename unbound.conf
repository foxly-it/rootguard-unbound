# =====================================================================
# RootGuard Unbound Engine
# ---------------------------------------------------------------------
# Base: Official Debian Unbound package
# Runtime: Container optimized (no systemd dependency)
#
# Architecture Principles:
#   • Full recursive resolver (no forwarding)
#   • DNSSEC validation enabled
#   • No external exposure (localhost binding)
#   • Foreground execution (Docker-compatible)
#   • No syslog dependency
#
# This file represents the static base configuration.
# In production, RootGuard may render and validate this dynamically.
# =====================================================================


server:

  # -------------------------------------------------------------------
  # Container Runtime Behaviour
  # -------------------------------------------------------------------

  # Disable syslog usage.
  # Debian builds Unbound with systemd/syslog support enabled.
  # Containers do not provide systemd/journald.
  # Logging must remain attached to stdout/stderr.
  use-syslog: no

  # Prevent daemonization.
  # Docker requires the main process to remain in foreground.
  daemonize: no

  # Disable file-based logging.
  # Log output is handled by Docker runtime.
  logfile: ""


  # -------------------------------------------------------------------
  # Network Binding
  # -------------------------------------------------------------------

  # Bind only to loopback interface.
  # This engine is intended to be consumed internally
  # (e.g. via shared network namespace with AdGuard).
  interface: 127.0.0.1

  # Internal resolver port used by RootGuard stack.
  port: 5335


  # -------------------------------------------------------------------
  # Privacy & Hardening Controls
  # -------------------------------------------------------------------

  # Do not expose server identity in CHAOS class queries.
  hide-identity: yes

  # Do not expose Unbound version.
  hide-version: yes

  # Enable QNAME minimisation (RFC 7816).
  # Reduces metadata leakage to upstream authoritative servers.
  qname-minimisation: yes

  # Refuse ANY queries.
  # Mitigates amplification abuse.
  deny-any: yes


  # -------------------------------------------------------------------
  # DNSSEC Validation
  # -------------------------------------------------------------------

  # Debian provides and maintains the root trust anchor via
  # the dns-root-data package.
  #
  # File location:
  #   /usr/share/dns/root.key
  #
  # RFC5011 automatic updates are handled by Unbound.
  auto-trust-anchor-file: "/usr/share/dns/root.key"


  # -------------------------------------------------------------------
  # Access Control
  # -------------------------------------------------------------------

  # Only allow local resolver access.
  # Prevents unintended exposure if container isolation fails.
  access-control: 127.0.0.1/32 allow


  # -------------------------------------------------------------------
  # Performance & Cache Configuration
  # -------------------------------------------------------------------

  # Thread count (single-threaded default for container baseline).
  num-threads: 1

  # Message cache size.
  msg-cache-size: 32m

  # Resource record set cache size.
  rrset-cache-size: 64m

  # Prefetch frequently requested records before expiry.
  # Improves latency under load.
  prefetch: yes


  # -------------------------------------------------------------------
  # Logging Verbosity
  # -------------------------------------------------------------------

  # 0 = silent
  # 1 = operational events (recommended production level)
  # 2+ = debugging
  verbosity: 1
